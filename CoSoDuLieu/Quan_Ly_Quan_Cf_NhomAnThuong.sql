--ĐỀ TÀI THỰC TẬP "PHẦN MỀM QUẢN LÝ QUÁN CÀ PHÊ"
--TRẦN THANH AN, VŨ THỊ THƯƠNG

--TẠO BẢNG
CREATE DATABASE QuanLyQuanCf
GO
USE QuanLyQuanCf


GO
CREATE TABLE NHANVIEN(
	MANV VARCHAR(10) NOT NULL PRIMARY KEY, --Làm tên tài khoản đăng nhập nhân viên
	TENNV NVARCHAR(50) NOT NULL,
	NGAYSINH DATE NOT NULL,
	GIOITINH NVARCHAR(5) NOT NULL,
	DIACHI NVARCHAR(100) NOT NULL,
	DIENTHOAI VARCHAR(11) NOT NULL,
	MATKHAU NVARCHAR(100) NOT NULL,
	QUYEN NVARCHAR(100) NOT NULL,
	LUONGCOBAN MONEY NOT NULL
)

GO
CREATE TABLE BAN(
	MABAN VARCHAR(5) NOT NULL PRIMARY KEY,
	TENBAN NVARCHAR(10) NOT NULL,
	TRANGTHAI NVARCHAR(100) NOT NULL DEFAULT N'TRỐNG'
)

GO
CREATE TABLE NHACUNGCAP(
	MANCC VARCHAR(10) NOT NULL PRIMARY KEY,
	TENNCC NVARCHAR(100) NOT NULL,
	DIACHINCC NVARCHAR(100) NOT NULL,
	DIENTHOAINCC VARCHAR(11) NOT NULL,
)

GO
CREATE TABLE PHIEUNHAP(
	MASONHAP VARCHAR(10) NOT NULL PRIMARY KEY,
	NGAYNHAP DATETIME NOT NULL,
	MANV VARCHAR(10) NOT NULL FOREIGN KEY REFERENCES NHANVIEN(MANV) ON DELETE NO ACTION
)

GO 
CREATE TABLE CHITIETPHIEUNHAP(
	MASONHAP VARCHAR(10) NOT NULL,
	MANCC VARCHAR(10) NOT NULL,
	SOLUONGNHAP INT NOT NULL
	PRIMARY KEY(MASONHAP,MANCC),
	CONSTRAINT FK_CT_MH FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC) ON DELETE NO ACTION,
	CONSTRAINT FK_PN_CT FOREIGN KEY (MASONHAP) REFERENCES PHIEUNHAP(MASONHAP) ON DELETE NO ACTION
)

GO
CREATE TABLE MATHANG(
	MAHANG VARCHAR(10) NOT NULL PRIMARY KEY,
	TENHANG NVARCHAR(30) NOT NULL,
	GIAHANGNHAP MONEY NOT NULL,
	SOLUONGHANG INT NOT  NULL
)

GO
CREATE TABLE CHITIETNHAPHANG(
	MASONHAP VARCHAR(10) NOT NULL,
	MAHANG VARCHAR(10) NOT NULL,
	PRIMARY KEY(MASONHAP,MAHANG),
	CONSTRAINT FK_CTNH_PN FOREIGN KEY (MASONHAP) REFERENCES PHIEUNHAP(MASONHAP) ON DELETE NO ACTION,
	CONSTRAINT FK_CTNH_MH FOREIGN KEY (MAHANG) REFERENCES MATHANG(MAHANG) ON DELETE NO ACTION
)

GO
CREATE TABLE SANPHAM(
	MASP VARCHAR(10) NOT NULL PRIMARY KEY,
	TENSP NVARCHAR(100) NOT NULL,
	DONGIABAN MONEY NOT NULL,
)

GO
CREATE TABLE CHEBIEN(
	MAHANG VARCHAR(10) NOT NULL,
	MASP VARCHAR(10) NOT NULL,
	PRIMARY KEY(MAHANG,MASP),
	CONSTRAINT FK_CB_MH FOREIGN KEY (MAHANG) REFERENCES MATHANG(MAHANG) ON DELETE NO ACTION,
	CONSTRAINT FK_CB_SP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP) ON DELETE NO ACTION
)

GO
CREATE TABLE HOADON(
	MAHOADON VARCHAR(20) NOT NULL PRIMARY KEY,
	NGAYNHAP DATETIME NULL,
	NGAYXUAT DATETIME NULL,
	MANV VARCHAR(10) NULL FOREIGN KEY REFERENCES NHANVIEN(MANV) ON DELETE SET NULL,
	MABAN VARCHAR(5) NULL FOREIGN KEY REFERENCES BAN(MABAN) ON DELETE SET NULL,
	GIAMGIA FLOAT NULL default 0,
	VAT FLOAT NULL default 0,
	THANHTOAN MONEY NULL,
	GHICHU NVARCHAR(1000) NULL
)


GO
CREATE TABLE HOADONCHITIET(
	--ID int IDENTITY(1,1) PRIMARY KEY,
	MAHOADON VARCHAR(20) NOT NULL,
	MASP VARCHAR(10) NOT NULL,
	SOLUONG INT NOT NULL,
	PRIMARY KEY (MAHOADON, MASP),
	CONSTRAINT FK_HDCT_HD FOREIGN KEY (MAHOADON) REFERENCES HOADON(MAHOADON) ON DELETE CASCADE,
	CONSTRAINT FK_HDCT_SP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP) ON DELETE CASCADE
)

--NHẬP DỮ LIỆU TỪNG BẢNG
GO
INSERT INTO NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, DIACHI, DIENTHOAI, MATKHAU, LUONGCOBAN, QUYEN)
VALUES ('NV0001', N'TRẦN THANH AN', '11/11/1997', N'Nam', 'Diên Khánh, Khánh Hòa', '0122345678', '21232F297A57A5A743894A0E4A801FC3', '3000000', N'ADMIN')
INSERT INTO NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, DIACHI, DIENTHOAI, MATKHAU, LUONGCOBAN, QUYEN)
VALUES ('NV0002', N'VŨ THỊ THƯƠNG', '12/01/1997', N'Nữ', 'Thanh An, Gia Lai', '01686276171', 'C4CA4238A0B923820DCC509A6F75849B', '4500000', N'QUẢN LÝ')
INSERT INTO NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, DIACHI, DIENTHOAI, MATKHAU, LUONGCOBAN, QUYEN)
VALUES ('NV0003', N'HUỲNH PHƯƠNG NGỌC', '09/08/1997', N'Nữ', 'Nha Trang, Khánh Hòa', '01663450987', 'C4CA4238A0B923820DCC509A6F75849B', '4500000', N'NHÂN VIÊN')
INSERT INTO NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, DIACHI, DIENTHOAI, MATKHAU, LUONGCOBAN, QUYEN)
VALUES ('NV0004', N'NGUYỄN THỊ NGÂN', '03/12/1997', N'Nữ', 'Nha Trang, Khánh Hòa', '0972456722', 'C4CA4238A0B923820DCC509A6F75849B', '6000000', 'NHÂN VIÊN')
INSERT INTO NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, DIACHI, DIENTHOAI, MATKHAU, LUONGCOBAN, QUYEN)
VALUES ('NV0005', N'LÊ MINH QUANG', '06/22/1997', N'Nam', 'Nha Trang, Khánh Hòa', '0122356321', 'C4CA4238A0B923820DCC509A6F75849B', '3000000', N'NHÂN VIÊN')

GO
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('01', N'BÀN 1')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('02', N'BÀN 2')
INSERT INTO BAN(MABAN, TENBAN, TRANGTHAI)
VALUES ('03', N'BÀN 3', N'CÓ')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('04', N'BÀN 4')
INSERT INTO BAN(MABAN, TENBAN, TRANGTHAI)
VALUES ('05', N'BÀN 5', N'CÓ')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('06', N'BÀN 6')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('07', N'BÀN 7')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('08', N'BÀN 8')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('09', N'BÀN 9')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('10', N'BÀN 10')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('11', N'BÀN 11')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('12', N'BÀN 12')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('13', N'BÀN 13')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('14', N'BÀN 14')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('15', N'BÀN 15')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('16', N'BÀN 16')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('17', N'BÀN 17')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('18', N'BÀN 18')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('19', N'BÀN 19')
INSERT INTO BAN(MABAN, TENBAN)
VALUES ('20', N'BÀN 20')

GO
INSERT INTO NHACUNGCAP(MANCC, TENNCC, DIACHINCC, DIENTHOAINCC)
VALUES ('CC0001', 'ME TRANG', 'DA NANG - VIET NAM', '01686276171')
INSERT INTO NHACUNGCAP(MANCC, TENNCC, DIACHINCC, DIENTHOAINCC)
VALUES ('CC0002', 'HOANG DONG', 'HA NOI - VIET NAM', '0165234977')
INSERT INTO NHACUNGCAP(MANCC, TENNCC, DIACHINCC, DIENTHOAINCC)
VALUES ('CC0003', 'NGOC & LIEN', 'HO CHI MINH - VIET NAM', '0974024571')
INSERT INTO NHACUNGCAP(MANCC, TENNCC, DIACHINCC, DIENTHOAINCC)
VALUES ('CC0004', 'TRUNG NGUYEN', 'DAKLAK - VIET NAM', '0122345634')
INSERT INTO NHACUNGCAP(MANCC, TENNCC, DIACHINCC, DIENTHOAINCC)
VALUES ('CC0005', 'TIEN MINH', 'HO CHI MINH - VIET NAM', '01687723451')

GO
INSERT INTO PHIEUNHAP(MASONHAP,NGAYNHAP, MANV)
VALUES ('PN0001','08/09/2017', 'NV0001')
INSERT INTO PHIEUNHAP(MASONHAP,NGAYNHAP, MANV)
VALUES ('PN0002','08/20/2017', 'NV0001')
INSERT INTO PHIEUNHAP(MASONHAP,NGAYNHAP, MANV)
VALUES ('PN0003','09/14/2017', 'NV0005')
INSERT INTO PHIEUNHAP(MASONHAP,NGAYNHAP, MANV)
VALUES ('PN0004','09/30/2017', 'NV0005')
INSERT INTO PHIEUNHAP(MASONHAP,NGAYNHAP, MANV)
VALUES ('PN0005','11/14/2017', 'NV0001')

GO
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0001','CC0002','100')
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0001','CC0004','70')
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0002','CC0003','30')
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0003','CC0001','30')
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0004','CC0005','25')
INSERT INTO CHITIETPHIEUNHAP(MASONHAP,MANCC,SOLUONGNHAP)
VALUES ('PN0005','CC0001','10')

GO
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0001', 'CAFE XAY', '70000', '10')
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0002', 'CAFE RANG', '85000', '10')
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0003', 'CA CHUA', '30000', '40')
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0004', 'DAU', '80000','30')
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0005', 'NHO DEN', '100000', '60')
INSERT INTO MATHANG(MAHANG, TENHANG, GIAHANGNHAP, SOLUONGHANG)
VALUES ('MH0006', 'SUA DAC', '120000', '60')

GO
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0001', 'MH0001')
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0001', 'MH0002')
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0002', 'MH0005')
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0003', 'MH0004')
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0004', 'MH0003')
INSERT INTO CHITIETNHAPHANG(MASONHAP, MAHANG)
VALUES ('PN0005', 'MH0006')

GO
INSERT INTO SANPHAM(MASP, TENSP, DONGIABAN)
VALUES ('SP0001', 'CAFE DEN', '20000')
INSERT INTO SANPHAM(MASP, TENSP, DONGIABAN)
VALUES ('SP0002', 'NUOC CAM VAT', '35000')
INSERT INTO SANPHAM(MASP, TENSP, DONGIABAN)
VALUES ('SP0003', 'SINH TO DAU', '40000')
INSERT INTO SANPHAM(MASP, TENSP, DONGIABAN)
VALUES ('SP0004', 'MATCHA SUA DA', '45000')
INSERT INTO SANPHAM(MASP, TENSP, DONGIABAN)
VALUES ('SP0005', 'CACAO NONG', '30000')

GO
INSERT INTO CHEBIEN(MAHANG,MASP)
VALUES ('MH0001', 'SP0001')
INSERT INTO CHEBIEN(MAHANG,MASP)
VALUES ('MH0004', 'SP0003')
INSERT INTO CHEBIEN(MAHANG,MASP)
VALUES ('MH0002', 'SP0001')
INSERT INTO CHEBIEN(MAHANG,MASP)
VALUES ('MH0006', 'SP0001')

GO
INSERT INTO HOADON(MAHOADON,NGAYNHAP, NGAYXUAT,MANV,MABAN,THANHTOAN,GHICHU)
VALUES ('HD0000000001', '10/02/2017', '10/02/2017','NV0003','02','65000', N'ĐÃ THU')
INSERT INTO HOADON(MAHOADON,NGAYNHAP,MANV,MABAN,GHICHU)
VALUES ('HD0000000002', '10/20/2017','NV0002','03', N'CHƯA THANH TOÁN')
INSERT INTO HOADON(MAHOADON,NGAYNHAP,MANV,MABAN,GHICHU)
VALUES ('HD0000000003', '10/30/2017','NV0003','05', N'CHƯA THANH TOÁN')
INSERT INTO HOADON(MAHOADON,NGAYNHAP, NGAYXUAT,MANV,MABAN,THANHTOAN,GHICHU)
VALUES ('HD0000000004', '12/02/2017', '12/02/2017','NV0004','01','190000', N'ĐÃ THU')

GO
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000001', 'SP0002','1')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000001', 'SP0005','1')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000002', 'SP0003','1')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000003', 'SP0004','3')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000003', 'SP0001','1')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000003', 'SP0005','1')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000004', 'SP0002','2')
INSERT INTO HOADONCHITIET(MAHOADON,MASP,SOLUONG)
VALUES ('HD0000000004', 'SP0003','3')